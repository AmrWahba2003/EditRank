// ---------------------------- Imports ----------------------------

// import: ุงุณุชูุฑุงุฏ ูู ููุชุจุฉ mongoose
// Schema: ูุจูุงุก ูููู (schema) ูููุณุชูุฏุงุช ูู MongoDB
// model: ูุฅูุดุงุก ูููุฐุฌ (model) ูููู ุงุณุชุฎุฏุงูู ููุชุนุงูู ูุน DB
// Document: ูุงุฌูุฉ TypeScript ุชูุซู ูุณุชูุฏ Mongoose (ุชุญุชูู ุนูู _id, save(), etc)
import { Schema, model, Document } from 'mongoose';

// ---------------------------- ุชุนุฑูู ูุงุฌูุฉ TypeScript ----------------------------

// IUser: ูุงุฌูุฉ TypeScript ูุชุนุฑูู ุดูู ุจูุงูุงุช ุงููุณุชุฎุฏู
// extends Document: ุชุถููู ุฎุตุงุฆุต Mongoose Document (_id, save, etc)
export interface IUser extends Document {
    googleId: string;   // ูุนุฑู ุงููุณุชุฎุฏู ูู Google OAuth
    name: string;       // ุงุณู ุงููุณุชุฎุฏู
    email: string;      // ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
    avatar?: string;    // ุฑุงุจุท ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ (ุงุฎุชูุงุฑู)
    avatarPublicId?: string;  // ๐ ูุงุฒู ูุถูู ูุฐุง ูุชุฎุฒูู public_id
    username: string;   // ุงุณู ุงููุณุชุฎุฏู ุงูุฎุงุต ุจุงููุธุงู
}

// ---------------------------- ุฅูุดุงุก ุงูู Schema ----------------------------

const userSchema = new Schema<IUser>({
    // googleId: ุญูู ููุนู Stringุ ูุทููุจ ููุฑูุฏ
    googleId: { type: String, required: true, unique: true },

    // name: ุญูู ุงูุงุณูุ ููุนู Stringุ ูุทููุจ
    name: { type: String, required: true },

    // email: ุงูุจุฑูุฏ ุงูุฅููุชุฑูููุ ูุทููุจ ููุฑูุฏ
    email: { type: String, required: true, unique: true },

    // avatar: ุฑุงุจุท ุงูุตูุฑุฉุ ุงุฎุชูุงุฑู
    avatar: { type: String },

    avatarPublicId: { type: String }, // ๐ ุงูุญูู ุงูุฌุฏูุฏ
    
    // username: ุงุณู ุงููุณุชุฎุฏู ุฏุงุฎู ุงููุธุงูุ ูุทููุจ ููุฑูุฏ
    username: { type: String, required: true, unique: true },
});

// ---------------------------- ุฅูุดุงุก ุงูู Model ----------------------------

// UserModel: ูููุฐุฌ Mongoose ูููู ุงุณุชุฎุฏุงูู ููุนูููุงุช CRUD
// 'User': ุงุณู ุงููุฌููุนุฉ (collection) ูู MongoDB ุณูุชู ุชุญูููู ุชููุงุฆููุง ุฅูู 'users'
// userSchema: ุงููููู ุงูุฐู ูุญุฏุฏ ุงูุญููู ูุงูุฃููุงุน ูุงูููุงุนุฏ
export const UserModel = model<IUser>('User', userSchema);

// ---------------------------- ููุงุญุธุงุช ุฃูุงู ูุฃุฏุงุก ----------------------------

/*
1. unique: ูุถูู ุนุฏู ุชูุฑุงุฑ googleId ุฃู email ุฃู username ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.
2. required: ูุถูู ุฃู ุงูุญููู ุงูุฃุณุงุณูุฉ ูู ุชููู ูุงุฑุบุฉ ุนูุฏ ุฅูุดุงุก ูุณุชุฎุฏู.
3. TypeScript interface IUser: ูุณุงุนุฏ ุนูู ุงูุชุญูู ูู ุงูุฃููุงุน ุนูุฏ ุงูุชุนุงูู ูุน ุงูุจูุงูุงุช ูู ุงูููุฏ.
4. ููุถู ุฅุถุงูุฉ Index ุนูู email ูusername ูุชุญุณูู ุณุฑุนุฉ ุงูุจุญุซ.
5. ูููู ุฅุถุงูุฉ hooks ูุซู pre('save') ูุชุดููุฑ ุฃู ุจูุงูุงุช ุญุณุงุณุฉ ุฃู ุชุนุฏูููุง ูุจู ุงูุญูุธ.
6. ุนูุฏ ุงูุชุฑููุฉ ุฅูู Feathers 5:
    - ูููู ุงุณุชุฎุฏุงู ูุฐุง ุงููููุฐุฌ ูุจุงุดุฑุฉ ูู Service class.
    - Hooks ูููู ุฃู ุชุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูุจู create ุฃู patch.
7. ูููู ุฑุจุท ูุฐุง ุงููููุฐุฌ ุจู JWT ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ูุฅุฑุฌุงุน ุจูุงูุงุช ุงููุณุชุฎุฏู ูุน ุชููู.
*/
