<div class="settings-container">

  <div class="setting-card">
    <h2>حذف الحساب</h2>
    <p class="warning">⚠️ حذف الحساب سيؤدي إلى حذف جميع الفيديوهات والرسائل بشكل نهائي!</p>
    <button class="feature-btn" id="deleteToggleBtn">حذف الحساب</button>

    <div id="deleteForm" style="display:none; margin-top:15px;">
      <p>اكتب كلمة <strong>delete</strong> لتأكيد:</p>
      <input type="text" id="confirmInput" placeholder="اكتب delete هنا">
      <button id="deleteBtn" disabled>حذف الحساب نهائياً</button>
    </div>
  </div>

  <div class="setting-card">
    <h2>ميزة أخرى</h2>
    <p>يمكنك إضافة ميزات إضافية هنا لاحقاً.</p>
    <button class="feature-btn">إعداد جديد</button>
  </div>

</div>

<style>
.settings-container{max-width:600px;margin:50px auto;display:flex;flex-direction:column;gap:20px;}
.setting-card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.1);}
.setting-card h2{margin-bottom:10px;color:#2575fc;}
.warning{color:#e53e3e;font-weight:700;}
.feature-btn{width:100%;padding:12px;background:#e53e3e;color:#fff;border:none;border-radius:8px;font-weight:700;cursor:pointer;transition:all .2s;}
.feature-btn:hover{background:#c53030;transform:translateY(-1px);}
#deleteBtn{background:#e53e3e;margin-top:10px;}
#deleteBtn:disabled{background:#999;cursor:not-allowed;}
</style>

<script>
// toggle delete form
const deleteToggleBtn = document.getElementById('deleteToggleBtn');
const deleteForm = document.getElementById('deleteForm');
deleteToggleBtn.addEventListener('click', () => {
  deleteForm.style.display = deleteForm.style.display === 'none' ? 'block' : 'none';
});

// same delete logic as before
const token = localStorage.getItem('jwt');
let currentUser = {};
try { currentUser = JSON.parse(atob(token.split('.')[1])); } catch(e){ console.error(e); }

const input = document.getElementById('confirmInput');
const deleteBtn = document.getElementById('deleteBtn');
input.addEventListener('input', () => { deleteBtn.disabled = input.value.trim().toLowerCase() !== 'delete'; });

deleteBtn.addEventListener('click', async () => {
  if(!confirm('هل أنت متأكد من حذف الحساب؟ هذا الإجراء لا يمكن التراجع عنه.')) return;
  deleteBtn.disabled = true;
  deleteBtn.textContent = 'جارٍ الحذف...';

  try {
    const res = await fetch(`/users/${currentUser.id}`, { method: 'DELETE', headers: { 'Authorization': 'Bearer ' + token } });
    const data = await res.json();
    if(!res.ok) throw new Error(data.error || 'حدث خطأ أثناء الحذف');
    alert('تم حذف الحساب بنجاح!');
    localStorage.removeItem('jwt');
    window.location.href = '/';
  } catch(err) {
    console.error(err);
    alert(err.message);
    deleteBtn.disabled = false;
    deleteBtn.textContent = 'حذف الحساب نهائياً';
  }
});
</script>
